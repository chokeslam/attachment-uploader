{"version":3,"file":"attachment.js","names":["initAttachmentList","el","options","removeBtns","querySelectorAll","insertBtns","sortable","defOptions","sort","handle","Object","assign","console","log","u","then","module","querySelector","ele","Sortable","forEach","btn","addEventListener","e","a","document","createElement","href","currentTarget","dataset","fileName","filename","setAttribute","innerText","$ui","tinymce","get","insertBtn","insert","outerHTML","tr","closest","removeAttribute","fadeOut","directive","mounted","value","JSON","parse"],"sources":["attachment.js"],"sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nu.directive(\n  'attachment-list',\n  {\n    mounted(el, { value }) {\n      initAttachmentList(el, JSON.parse(value));\n    }\n  }\n);\n\nfunction initAttachmentList(el, options) {\n  const removeBtns = el.querySelectorAll('[data-remove-btn]');\n  const insertBtns = el.querySelectorAll('[data-insert-btn]');\n\n  let sortable = options.sortable;\n\n  if (sortable) {\n    const defOptions = {\n      sort: true,\n      handle: '.c-handle',\n    };\n\n    if (typeof sortable !== 'object') {\n      sortable = {};\n    }\n\n    sortable = Object.assign(defOptions, sortable);\n    console.log(sortable);\n    u.import('@sortablejs').then(() => {\n      u.module(\n        el.querySelector('table tbody'),\n        'attachment.sortable',\n        (ele) => new Sortable(ele, sortable)\n      );\n    });\n  }\n\n  // insert to editor\n  insertBtns.forEach((btn) => {\n    btn.addEventListener('click', (e) => {\n      let a = document.createElement('a');\n      const href = e.currentTarget.dataset.href;\n      const fileName = e.currentTarget.dataset.filename;\n\n      a.setAttribute('target', '_blank');\n      a.setAttribute('href', href);\n      a.innerText = fileName;\n\n      u.$ui.tinymce.get(btn.dataset.insertBtn || '#input-item-fulltext').insert(a.outerHTML);\n    });\n  });\n\n  // remove file\n  removeBtns.forEach((btn) => {\n    btn.addEventListener('click', (e) => {\n      let tr = e.currentTarget.closest('tr');\n\n      tr.querySelector('[data-remove]').removeAttribute('disabled');\n\n      u.$ui.fadeOut(tr);\n    });\n  });\n}\n"],"mappings":";;;;;EAkBA,SAASA,kBAAT,CAA4BC,EAA5B,EAAgCC,OAAhC,EAAyC;IACvC,IAAMC,UAAU,GAAGF,EAAE,CAACG,gBAAH,CAAoB,mBAApB,CAAnB;IACA,IAAMC,UAAU,GAAGJ,EAAE,CAACG,gBAAH,CAAoB,mBAApB,CAAnB;IAEA,IAAIE,QAAQ,GAAGJ,OAAO,CAACI,QAAvB;;IAEA,IAAIA,QAAJ,EAAc;MACZ,IAAMC,UAAU,GAAG;QACjBC,IAAI,EAAE,IADW;QAEjBC,MAAM,EAAE;MAFS,CAAnB;;MAKA,IAAI,QAAOH,QAAP,MAAoB,QAAxB,EAAkC;QAChCA,QAAQ,GAAG,EAAX;MACD;;MAEDA,QAAQ,GAAGI,MAAM,CAACC,MAAP,CAAcJ,UAAd,EAA0BD,QAA1B,CAAX;MACAM,OAAO,CAACC,GAAR,CAAYP,QAAZ;MACAQ,CAAC,UAAD,CAAS,aAAT,EAAwBC,IAAxB,CAA6B,YAAM;QACjCD,CAAC,CAACE,MAAF,CACEf,EAAE,CAACgB,aAAH,CAAiB,aAAjB,CADF,EAEE,qBAFF,EAGE,UAACC,GAAD;UAAA,OAAS,IAAIC,QAAJ,CAAaD,GAAb,EAAkBZ,QAAlB,CAAT;QAAA,CAHF;MAKD,CAND;IAOD,CAzBsC,CA2BvC;;;IACAD,UAAU,CAACe,OAAX,CAAmB,UAACC,GAAD,EAAS;MAC1BA,GAAG,CAACC,gBAAJ,CAAqB,OAArB,EAA8B,UAACC,CAAD,EAAO;QACnC,IAAIC,CAAC,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAR;QACA,IAAMC,IAAI,GAAGJ,CAAC,CAACK,aAAF,CAAgBC,OAAhB,CAAwBF,IAArC;QACA,IAAMG,QAAQ,GAAGP,CAAC,CAACK,aAAF,CAAgBC,OAAhB,CAAwBE,QAAzC;QAEAP,CAAC,CAACQ,YAAF,CAAe,QAAf,EAAyB,QAAzB;QACAR,CAAC,CAACQ,YAAF,CAAe,MAAf,EAAuBL,IAAvB;QACAH,CAAC,CAACS,SAAF,GAAcH,QAAd;QAEAhB,CAAC,CAACoB,GAAF,CAAMC,OAAN,CAAcC,GAAd,CAAkBf,GAAG,CAACQ,OAAJ,CAAYQ,SAAZ,IAAyB,sBAA3C,EAAmEC,MAAnE,CAA0Ed,CAAC,CAACe,SAA5E;MACD,CAVD;IAWD,CAZD,EA5BuC,CA0CvC;;IACApC,UAAU,CAACiB,OAAX,CAAmB,UAACC,GAAD,EAAS;MAC1BA,GAAG,CAACC,gBAAJ,CAAqB,OAArB,EAA8B,UAACC,CAAD,EAAO;QACnC,IAAIiB,EAAE,GAAGjB,CAAC,CAACK,aAAF,CAAgBa,OAAhB,CAAwB,IAAxB,CAAT;QAEAD,EAAE,CAACvB,aAAH,CAAiB,eAAjB,EAAkCyB,eAAlC,CAAkD,UAAlD;QAEA5B,CAAC,CAACoB,GAAF,CAAMS,OAAN,CAAcH,EAAd;MACD,CAND;IAOD,CARD;EASD;;;;;MA7DD1B,CAAC,CAAC8B,SAAF,CACE,iBADF,EAEE;QACEC,OADF,mBACU5C,EADV,QACyB;UAAA,IAAT6C,KAAS,QAATA,KAAS;UACrB9C,kBAAkB,CAACC,EAAD,EAAK8C,IAAI,CAACC,KAAL,CAAWF,KAAX,CAAL,CAAlB;QACD;MAHH,CAFF"}