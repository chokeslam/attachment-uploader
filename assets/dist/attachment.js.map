{"version":3,"file":"attachment.js","names":["u","uploader","document","getElementById","input","overlayLabel","querySelector","removeBtns","querySelectorAll","insertBtns","options","JSON","parse","dataset","accepted","accept","split","map","v","trim","filter","length","indexOf","substr","addEventListener","e","onChange","classList","add","remove","forEach","btn","a","createElement","href","currentTarget","fileName","filename","setAttribute","innerText","$ui","tinymce","get","insert","outerHTML","tr","closest","removeAttribute","files","text","Array","prototype","call","file","checkType","name","innerHTML","fileExt","pop","allow","type","compareMimeType","alert","__","join","Error"],"sources":["attachment.js"],"sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport u from '@main';\n\n(() => {\n  const uploader = document.getElementById('accachment-uploader');\n  const input = document.getElementById('input-attachment-files');\n  const overlayLabel = document.querySelector('[data-overlay-label]');\n  const removeBtns = document.querySelectorAll('[data-remove-btn]');\n  const insertBtns = document.querySelectorAll('[data-insert-btn]');\n  const options = JSON.parse(uploader.dataset.options || '{}');\n  const accepted = (options.accept || '')\n    .split(',')\n    .map(v => v.trim())\n    .filter(v => v.length > 0)\n    .map(v => {\n      if (v.indexOf('/') === -1 && v[0] === '.') {\n        return v.substr(1);\n      }\n\n      return v;\n    });\n\n  input.addEventListener('change', (e) => {\n    onChange(e);\n  });\n\n  input.addEventListener('dragover', () => {\n    input.classList.add('hover');\n  });\n\n  input.addEventListener('dragleave', () => {\n    input.classList.remove('hover');\n  });\n\n  input.addEventListener('drop', () => {\n    input.classList.remove('hover');\n  });\n\n  // insert to editor\n  insertBtns.forEach((btn) => {\n    btn.addEventListener('click', (e) => {\n      let a = document.createElement('a');\n      const href = e.currentTarget.dataset.href;\n      const fileName = e.currentTarget.dataset.filename;\n\n      a.setAttribute('target', '_blank');\n      a.setAttribute('href', href);\n      a.innerText = fileName;\n\n      u.$ui.tinymce.get('#input-item-fulltext').insert(a.outerHTML);\n    });\n  });\n\n  // remove file\n  removeBtns.forEach((btn) => {\n    btn.addEventListener('click', (e) => {\n      let tr = e.currentTarget.closest('tr');\n\n      tr.querySelector('[data-remove]').removeAttribute('disabled');\n      tr.classList.add('hide');\n    });\n  });\n\n  function onChange(e) {\n    const files = input.files;\n    let text = '';\n\n    Array.prototype.forEach.call(files, file => {\n      checkType(accepted, file);\n\n      text += `<div>${file.name}</div>`;\n      overlayLabel.innerHTML = text;\n    });\n  }\n\n  function checkType(accepted, file) {\n    const fileExt = file.name.split('.').pop();\n\n    if (accepted.length) {\n      let allow = false;\n\n      accepted.forEach((type) => {\n        if (allow) {\n          return;\n        }\n\n        if (type.indexOf('/') !== -1) {\n          if (this.compareMimeType(type, file.type)) {\n            allow = true;\n          }\n        } else {\n          if (type === fileExt) {\n            allow = true;\n          }\n        }\n      });\n\n      if (!allow) {\n\n        u.alert(\n          u.__('unicorn.field.file.drag.message.unaccepted.files'),\n          u.__('unicorn.field.file.drag.message.unaccepted.files.desc', accepted.join(', ')),\n          'warning'\n        );\n        throw new Error('Not accepted file ext');\n      }\n    }\n  }\n})();\n"],"mappings":"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"}